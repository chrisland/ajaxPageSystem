/*
	
	ajaxPageSystem - min
	
	
	Christian Marienfeld
	www.chrisland.de
	
	Version 1.3.2
	https://github.com/chrisland/ajaxPageSystem
	
	
	Licence MIT

*/

var APS=APS||{};APS.page=function(){var t={handler:"pageBtn",displayStyle:"block",offButton:"pageBtnOffline",mockupDebug:!1,mockup:{},container:"page"},e=0,a=0,n=0,r=[],o="#overlay",i=function(t){return"url(img/overlay/"+t+".svg)"},s=function(n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);return a?APS.page.changePageById(a):t.start&&APS.page.changePageById(t.start),e},l=function(e,a){var n=document.createElement("div");n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.top=0,n.style.left=0;for(var r=0;r<e.length;r++){var o=e[r],i=document.createElement("button");i.style.position="absolute",i.style.zindex=9999999+a+r,i.style.left=o.x+"vw",i.style.top=o.y+"vh",i.style.width=o.width+"vw",i.style.height=o.height+"vh",i.style.border=0,i.style.outline=0,i.style.curser="pointer",i.style.backgroundColor="rgba(0,0,0,0)",1==t.mockupDebug&&(i.style.backgroundColor="rgba(255,200,0,0.5)",i.style.border="1px solid #ffc800",o.title&&(i.innerHTML=o.title)),i.setAttribute("class",t.handler),i.setAttribute("data-page",o.page),i.setAttribute("data-task",o.task),i.setAttribute("data-content",o.content),n.appendChild(i)}return n},u=function(t,e,a){var n=d(null,e,a,t);return n&&fadePageDom(t,function(){"function"==typeof n&&n(),addBtnEventListener(),addPageHistory(t,e,a)}),!1},c=function(e){if(e.classList.contains(t.offButton))return!1;var a=e.getAttribute("data-page"),n=e.getAttribute("data-task"),r=e.getAttribute("data-content"),o=d(e,n,r,a);return o&&fadePageDom(a,function(){"function"==typeof o&&o(),addBtnEventListener(),addPageHistory(a,n,r)}),!1},d=function(t,e,a,n){if("back"==e){var r=getPageHistory(),o=r[r.length-2];return o?(o.pageId&&(APS.page.changePageById(o.pageId,o.pageTask,o.pageContent),kickLastPageHistory(2)),!0):!1}return APS.task&&APS.task[e]?APS.task[e](n,a,t):!0};return fadePageDom=function(n,r){return n&&jQuery.ajax({url:"tmpl/"+n+".tpl",dataType:"html",cache:!1,success:function(o){var i=document.getElementById(t.container);if(i.innerHTML=o,t.mockup[n]){var s=l(t.mockup[n],n);i.appendChild(s)}a=e,e=n,r&&r()}}),!1},addBtnEventListener=function(){for(var a=function(){var t=this.getAttribute("data-page"),a=this.getAttribute("data-task");if(t||a){if(e==t)return!1;c(this)}},n=document.getElementsByClassName(t.handler),r=0;r<n.length;r++)n[r].style.curser="pointer",n[r].addEventListener("click",a)},addPageHistory=function(t,e,a){if(t){var n={pageId:t,pageTask:e,pageContent:a};r.push(n)}},getPageHistory=function(){return r?r:!1},kickLastPageHistory=function(t){r=r.slice(0,r.length-t)},openOverlay=function(e,a){var r=document.getElementById(o);r.style.backgroundImage=i(e),r.style.display=t.displayStyle,a&&(clearTimeout(n),n=setTimeout(function(){closeOverlay()},a))},closeOverlay=function(){document.getElementById(o).style.display="none"},{initialize:s,changePageById:u,openOverlay:openOverlay,closeOverlay:closeOverlay}}();