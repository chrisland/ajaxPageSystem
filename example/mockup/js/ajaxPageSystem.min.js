/*
	
	ajaxPageSystem - min
	
	
	Christian Marienfeld
	www.chrisland.de
	
	Version 1.3.1
	https://github.com/chrisland/ajaxPageSystem
	
	
	Licence MIT

*/

var APS=APS||{};APS.page=function(){var t={handler:"pageBtn",displayStyle:"block",offButton:"pageBtnOffline",mockupDebug:!1,mockup:{},container:"page"},e=0,a=0,n=0,r=[],i="#overlay",o=function(t){return"url(img/overlay/"+t+".svg)"},s=function(n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);return a?APS.page.changePageById(a):t.start&&APS.page.changePageById(t.start),e},l=function(e,a){var n=document.createElement("div");n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.top=0,n.style.left=0;for(var r=0;r<e.length;r++){var i=e[r],o=document.createElement("button");o.style.position="absolute",o.style.zindex=9999999+a+r,o.style.left=i.x+"vw",o.style.top=i.y+"vh",o.style.width=i.width+"vw",o.style.height=i.height+"vh",o.style.border=0,o.style.outline=0,o.style.curser="pointer",o.style.backgroundColor="rgba(0,0,0,0)",1==t.mockupDebug&&(o.style.backgroundColor="rgba(255,200,0,0.5)",o.style.border="1px solid #ffc800",i.title&&(o.innerHTML=i.title)),o.setAttribute("class",t.handler),o.setAttribute("data-page",i.page),o.setAttribute("data-task",i.task),o.setAttribute("data-content",i.content),n.appendChild(o)}return n},u=function(t,e,a){var n=d(null,e,a,t);return n&&fadePageDom(t,function(){addBtnEventListener(),addPageHistory(t,e,a)}),!1},c=function(e){if(e.classList.contains(t.offButton))return!1;var a=e.getAttribute("data-page"),n=e.getAttribute("data-task"),r=e.getAttribute("data-content"),i=d(e,n,r,a);return i&&fadePageDom(a,function(){addBtnEventListener(),addPageHistory(a,n,r)}),!1},d=function(t,e,a,n){if("back"==e){var r=getPageHistory(),i=r[r.length-2];return i?(i.pageId&&(APS.page.changePageById(i.pageId,i.pageTask,i.pageContent),kickLastPageHistory(2)),!0):!1}return APS.task&&APS.task[e]?APS.task[e](n,a,t):!0};return fadePageDom=function(n,r){return n&&jQuery.ajax({url:"tmpl/"+n+".tpl",dataType:"html",cache:!1,success:function(i){var o=document.getElementById(t.container);if(o.innerHTML=i,t.mockup[n]){var s=l(t.mockup[n],n);o.appendChild(s)}a=e,e=n,r&&r()}}),!1},addBtnEventListener=function(){for(var a=function(){var t=this.getAttribute("data-page"),a=this.getAttribute("data-task");if(t||a){if(e==t)return!1;c(this)}},n=document.getElementsByClassName(t.handler),r=0;r<n.length;r++)n[r].style.curser="pointer",n[r].addEventListener("click",a)},addPageHistory=function(t,e,a){if(t){var n={pageId:t,pageTask:e,pageContent:a};r.push(n)}},getPageHistory=function(){return r?r:!1},kickLastPageHistory=function(t){r=r.slice(0,r.length-t)},openOverlay=function(e,a){var r=document.getElementById(i);r.style.backgroundImage=o(e),r.style.display=t.displayStyle,a&&(clearTimeout(n),n=setTimeout(function(){closeOverlay()},a))},closeOverlay=function(){document.getElementById(i).style.display="none"},{initialize:s,changePageById:u,openOverlay:openOverlay,closeOverlay:closeOverlay}}();