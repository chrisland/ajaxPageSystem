
/*
	
	ajaxPageSystem - min
	
	
	Christian Marienfeld
	www.chrisland.de
	
	Version 1.3.3
	https://github.com/chrisland/ajaxPageSystem
	
	
	Licence MIT

*/


var APS=APS||{};APS.page=function(){var t={handler:"pageBtn",displayStyle:"block",offButton:"pageBtnOffline",mockupDebug:!1,mockup:{},container:"page"},e=0,n=0,a=0,r=[],i="overlay",o=function(t){return"url(img/overlay/"+t+".svg)"},s=void 0,l=function(a){for(var r in a)a.hasOwnProperty(r)&&(t[r]=a[r]);return s=document.getElementById(t.container),n?APS.page.changePageById(n):t.start&&APS.page.changePageById(t.start),e},u=function(e,n){var a=document.createElement("div");a.style.position="absolute",a.style.width=0,a.style.height=0,a.style.top=0,a.style.left=0;for(var r=0;r<e.length;r++){var i=e[r],o=document.createElement("button");o.style.position="absolute",o.style.zindex=9999999+n+r,o.style.left=i.x+"vw",o.style.top=i.y+"vh",o.style.width=i.width+"vw",o.style.height=i.height+"vh",o.style.border=0,o.style.outline=0,o.style.curser="pointer",o.style.backgroundColor="rgba(0,0,0,0)",1==t.mockupDebug&&(o.style.backgroundColor="rgba(255,200,0,0.5)",o.style.border="1px solid #ffc800",i.title&&(o.innerHTML=i.title)),o.setAttribute("class",t.handler),o.setAttribute("data-page",i.page),o.setAttribute("data-task",i.task),o.setAttribute("data-content",i.content),a.appendChild(o)}return a},c=function(t,e,n){var a=g(null,e,n,t);return a?(fadePageDom(t,function(){"function"==typeof a&&a(),addBtnEventListener(),addPageHistory(t,e,n)}),!0):!1},d=function(e){if(e.classList.contains(t.offButton))return!1;var n=e.getAttribute("data-page"),a=e.getAttribute("data-task"),r=e.getAttribute("data-content"),i=g(e,a,r,n);return i&&fadePageDom(n,function(){"function"==typeof i&&i(),addBtnEventListener(),addPageHistory(n,a,r)}),!1},g=function(t,e,n,a){if("back"==e){var r=getPageHistory(),i=r[r.length-2];return i?(i.pageId&&(APS.page.changePageById(i.pageId,i.pageTask,i.pageContent),kickLastPageHistory(2)),!0):!1}return APS.task&&APS.task[e]?APS.task[e](a,n,t,s):!0};return fadePageDom=function(a,r){return a&&jQuery.ajax({url:"tmpl/"+a+".tpl",dataType:"html",cache:!1,success:function(i){if(s.innerHTML=i,t.mockup[a]){var o=u(t.mockup[a],a);s.appendChild(o)}n=e,e=a,r&&r()}}),!1},addBtnEventListener=function(){for(var n=function(){var t=this.getAttribute("data-page"),n=this.getAttribute("data-task");if(t||n){if(e==t)return!1;d(this)}},a=document.getElementsByClassName(t.handler),r=0;r<a.length;r++)a[r].style.curser="pointer",a[r].addEventListener("click",n)},addPageHistory=function(t,e,n){if(t){var a={pageId:t,pageTask:e,pageContent:n};r.push(a)}},getPageHistory=function(){return r?r:!1},kickLastPageHistory=function(t){r=r.slice(0,r.length-t)},openOverlay=function(e,n){var r=document.getElementById(i);r.style.backgroundImage=o(e),r.style.display=t.displayStyle,n&&(clearTimeout(a),a=setTimeout(function(){closeOverlay()},n))},closeOverlay=function(){document.getElementById(i).style.display="none"},{initialize:l,changePageById:c,clickEvents:addBtnEventListener,openOverlay:openOverlay,closeOverlay:closeOverlay}}();